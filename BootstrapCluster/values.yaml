apps:
  cert-manager:
    enabled: true
    namespace: cert-manager
    metadata:
      name: cert-manager
      namespace: argocd
      finalizers:
      - resources-finalizer.argocd.argoproj.io
      annotations:
        argocd.argoproj.io/sync-wave: "0"
        argocd.argoproj.io/refresh: always
    project: default
    repoURL: https://charts.jetstack.io
    chart: cert-manager
    targetRevision: v1.15.3
    helm:
      releaseName: cert-manager
      values:
        crds:
          enabled: true
    syncPolicy:
      automated:
        prune: true
        selfHeal: true
      retry:
        limit: 10
        backoff:
          duration: 5s
          factor: 2
          maxDuration: 1m
      syncOptions:
      - CreateNamespace=true
      - PrunePropagationPolicy=foreground

  istio-system:
    enabled: true
    namespace: istio-system
    metadata:
      name: istio-base
      namespace: argocd
      finalizers:
      - resources-finalizer.argocd.argoproj.io
      annotations:
        argocd.argoproj.io/sync-wave: "1"
        argocd.argoproj.io/refresh: always
    project: default
    repoURL: https://istio-release.storage.googleapis.com/charts
    chart: base
    targetRevision: 1.23.2
    helm:
      releaseName: istio-base
      values:
        defaultRevision: default
    syncPolicy:
      automated:
        prune: true
        selfHeal: false
      retry:
        limit: 10
        backoff:
          duration: 5s
          factor: 2
          maxDuration: 10m
      syncOptions:
      - CreateNamespace=true
      - PrunePropagationPolicy=foreground
      - RespectIgnoreDifferences=true
    extraSpecs:
      ignoreDifferences:
      - group: "admissionregistration.k8s.io"
        kind: "ValidatingWebhookConfiguration"
        name: "istiod-default-validator"
        jsonPointers:
        - "/webhooks/0/failurePolicy"
  istiod:
    enabled: true
    namespace: istio-system
    metadata:
      name: istiod
      namespace: argocd
      finalizers:
      - resources-finalizer.argocd.argoproj.io
      annotations:
        argocd.argoproj.io/sync-wave: "2"
        argocd.argoproj.io/refresh: always
    project: default
    repoURL: https://istio-release.storage.googleapis.com/charts
    chart: istiod
    targetRevision: 1.23.2
    helm:
      releaseName: istiod
      values: ""
    syncPolicy:
      automated:
        prune: true
        selfHeal: true
      syncOptions:
      - CreateNamespace=true
      - PrunePropagationPolicy=foreground
      - ApplyOutOfSyncOnly=true
    extraSpecs:
      ignoreDifferences:
      - group: "admissionregistration.k8s.io"
        kind: "ValidatingWebhookConfiguration"
        name: "istio-validator-istio-system"
        jsonPointers:
        - "/webhooks/0/failurePolicy"


  jaeger:
    enabled: true
    namespace: jaeger
    metadata:
      name: jaeger
      namespace: argocd
      finalizers:
      - resources-finalizer.argocd.argoproj.io
      annotations:
        argocd.argoproj.io/sync-wave: "3"
        argocd.argoproj.io/refresh: always
    project: default
    repoURL: https://jaegertracing.github.io/helm-charts
    chart: jaeger
    targetRevision: 3.3.1
    helm:
      releaseName: jaeger
      values:
        provisionDataStore:
          cassandra: false
        allInOne:
          enabled: true
        storage:
          type: memory
        agent:
          enabled: false
        collector:
          enabled: true
        query:
          enabled: true
    syncPolicy:
      automated:
        prune: true
        selfHeal: true
      retry:
        limit: 10
        backoff:
          duration: 10s
          factor: 2
          maxDuration: 3m
      syncOptions:
      - CreateNamespace=true
      - PrunePropagationPolicy=foreground

  kiali-operator:
    enabled: true
    namespace: kiali-operator
    metadata:
      name: kiali-operator
      namespace: argocd
      finalizers:
      - resources-finalizer.argocd.argoproj.io
      annotations:
        argocd.argoproj.io/sync-wave: "3"
        argocd.argoproj.io/refresh: always
    project: default
    repoURL: https://kiali.org/helm-charts
    chart: kiali-operator
    targetRevision: 1.89.3
    helm:
      releaseName: kiali-operator
      values:
        cr:
          create: true
          namespace: istio-system
          spec:
            auth:
              strategy: anonymous
            external_services:
              prometheus:
                url: http://prometheus-istio-server:9090
        metrics:
          enabled: true
    syncPolicy:
      automated:
        prune: true
        selfHeal: true
      retry:
        limit: 10
        backoff:
          duration: 5s
          factor: 2
          maxDuration: 5m
      syncOptions:
      - CreateNamespace=true
      - PrunePropagationPolicy=foreground

  kiali-prometheus-operator:
    enabled: true
    namespace: istio-system
    metadata:
      name: prometheus-istio
      namespace: argocd
      finalizers:
      - resources-finalizer.argocd.argoproj.io
      annotations:
        argocd.argoproj.io/sync-wave: "1"
        argocd.argoproj.io/refresh: always
    project: default
    repoURL: https://prometheus-community.github.io/helm-charts
    chart: prometheus
    targetRevision: 25.27.0
    helm:
      releaseName: prometheus-istio
      values:
        alertmanager:
          enabled: false
        server:
          service:
            servicePort: 9090

          global:
            scrape_interval: 15s
        prometheus.yml:
          rule_files:
          - /etc/config/recording_rules.yml
          - /etc/config/alerting_rules.yml
          scrape_configs:
          # Scrape Prometheus
          - job_name: prometheus
            static_configs:
            - targets:
              - localhost:9090
          - job_name: 'istiod'
            # Scrape Istiod stats from istio-system namespace
            kubernetes_sd_configs:
            - role: endpoints
              namespaces:
                names:
                - istio-system
            relabel_configs:
            - source_labels: [__meta_kubernetes_service_name, __meta_kubernetes_endpoint_port_name]
              action: keep
              regex: istiod;http-monitoring
          - job_name: 'envoy-stats'
            # Scrape Envoy stats from sidecar and gateway proxies
            metrics_path: /stats/prometheus
            kubernetes_sd_configs:
            - role: pod
            relabel_configs:
            - source_labels: [__meta_kubernetes_pod_container_port_name]
              action: keep
              regex: '.*-envoy-prom'

    syncPolicy:
      automated:
        prune: true
        selfHeal: true
      retry:
        limit: 10
        backoff:
          duration: 5s
          factor: 2
          maxDuration: 5m
      syncOptions:
      - CreateNamespace=true
      - PrunePropagationPolicy=foreground

  traefik:
    enabled: true
    namespace: traefik
    metadata:
      name: traefik
      namespace: argocd
      annotations:
        argocd.argoproj.io/sync-wave: "0"
        argocd.argoproj.io/refresh: always
    project: default
    repoURL: https://traefik.github.io/charts
    chart: traefik
    targetRevision: 31.1.1
    helm:
      releaseName: traefik
      values:
        service:
          type: NodePort
        ports:
          web:
            nodePort: 30000
          websecure:
            nodePort: 30001
        nodeSelector:
          ingress-ready: "true"
        tolerations:
        - key: "node-role.kubernetes.io/master"
          operator: "Equal"
          effect: "NoSchedule"
        providers:
          kubernetesGateway:
            enabled: true
          kubernetesCRD:
            ingressClass: traefik
          kubernetesIngress:
            ingressClass: traefik
        gateway:
          listeners:
            web:
              namespacePolicy: All
        ingressRoute:
          dashboard:
            enabled: true
        experimental:
          kubernetesGateway:
            enabled: true
    syncPolicy:
      automated:
        selfHeal: true
        prune: true
      retry:
        limit: 20
        backoff:
          duration: 5s
          factor: 2
          maxDuration: 3m
      syncOptions:
      - CreateNamespace=true
      - PrunePropagationPolicy=foreground

  helm-dashboard:
    enabled: true
    namespace: helm-dashboard
    metadata:
      name: helm-dashboard
      namespace: argocd
      finalizers:
      - resources-finalizer.argocd.argoproj.io
      annotations:
        argocd.argoproj.io/sync-wave: "2"
        argocd.argoproj.io/refresh: always
    project: default
    repoURL: https://helm-charts.komodor.io
    chart: helm-dashboard
    targetRevision: 0.1.10
    helm:
      releaseName: helm-dashboard
      values:
        ingress:
          enabled: false
          className: traefik
          hosts:
          - host: helm-dashboard.localhost
            paths:
            - path: /
              pathType: Prefix
        service:
          type: ClusterIP
          port: 80
    syncPolicy:
      automated:
        selfHeal: true
        prune: true
      retry:
        limit: 20
        backoff:
          duration: 5s
          factor: 2
          maxDuration: 3m
      syncOptions:
      - CreateNamespace=true
      - PrunePropagationPolicy=foreground


  istiod-ingress:
    enabled: false
    namespace: istio-ingress
    metadata:
      name: istio-ingress
      namespace: argocd
      finalizers:
      - resources-finalizer.argocd.argoproj.io
      annotations:
        argocd.argoproj.io/sync-wave: "3"
        argocd.argoproj.io/refresh: always
    project: default
    repoURL: https://istio-release.storage.googleapis.com/charts
    chart: gateway
    targetRevision: 1.23.2
    helm:
      releaseName: istio-ingress
      values:
        service:
          service:
          type: NodePort
          ports:
          - name: status-port
            port: 15021
            protocol: TCP
            targetPort: 15021
          - name: http2
            port: 80
            protocol: TCP
            targetPort: 80
          - name: https
            port: 443
            protocol: TCP
            targetPort: 443
    syncPolicy:
      automated:
        prune: true
        selfHeal: true
        allowEmpty: true
      retry:
        limit: 2
        backoff:
          duration: 5s
          factor: 2
          maxDuration: 30s
      syncOptions:
      - CreateNamespace=true
      - PrunePropagationPolicy=orphan
      - ApplyOutOfSyncOnly=false
      - Replace=true
      managedNamespaceMetadata:
        labels:
          istio-injection: enabled
    extraSpecs:
      orphanedResources:
        warn: false
        ignore:
        - kind: Deployment
          name: istiod-ingress


  metallb:
    enabled: false
    namespace: metallb-system
    metadata:
      name: metallb
      namespace: argocd
      finalizers:
      - resources-finalizer.argocd.argoproj.io
      annotations:
        argocd.argoproj.io/sync-wave: "1"
    project: default
    repoURL: https://metallb.github.io/metallb
    chart: metallb
    targetRevision: 0.14.8
    helm:
      releaseName: metallb
      values:
        prometheus:
          scrapeAnnotations: true
        rbac:
          create: true
        speaker:
          tolerateMaster: true
          memberlist:
            enabled: true
    syncPolicy:
      automated:
        prune: true
        selfHeal: true
      retry:
        limit: 10
        backoff:
          duration: 5s
          factor: 2
          maxDuration: 10m
      syncOptions:
      - CreateNamespace=true
      - PrunePropagationPolicy=foreground


  gateway-api:
    enabled: false
    namespace: gateway-api-system
    metadata:
      name: gateway-api
      namespace: argocd
      finalizers:
      - resources-finalizer.argocd.argoproj.io
      annotations:
        argocd.argoproj.io/sync-wave: "0"
    project: default
    repoURL: https://charts.appscode.com/stable/
    chart: gateway-api
    targetRevision: 1.0.0
    helm:
      releaseName: my-gateway-api
      values: {}
    syncPolicy:
      automated:
        prune: true
        selfHeal: true
      retry:
        limit: 10
        backoff:
          duration: 5s
          factor: 2
          maxDuration: 10m
      syncOptions:
      - CreateNamespace=true
      - PrunePropagationPolicy=foreground
